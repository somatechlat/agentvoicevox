/**
 * SpiceDB Schema for AgentVoiceBox Platform
 *
 * Defines the authorization model with 6 roles:
 * - sysadmin: System-wide administrator
 * - admin: Tenant administrator
 * - developer: Can manage projects and API keys
 * - operator: Can manage sessions and voice configs
 * - viewer: Read-only access
 * - billing: Billing and usage access
 */

definition user {}

definition tenant {
    // Direct role assignments
    relation sysadmin: user
    relation admin: user
    relation developer: user
    relation operator: user
    relation viewer: user
    relation billing: user

    // Computed permissions (hierarchical)
    permission manage = sysadmin
    permission administrate = sysadmin + admin
    permission develop = sysadmin + admin + developer
    permission operate = sysadmin + admin + developer + operator
    permission view = sysadmin + admin + developer + operator + viewer
    permission billing_access = sysadmin + admin + billing

    // Specific permissions
    permission create_project = develop
    permission manage_users = administrate
    permission manage_settings = administrate
    permission view_audit = administrate
    permission manage_billing = billing_access
}

definition project {
    relation tenant: tenant
    relation owner: user
    relation developer: user
    relation viewer: user

    // Inherit from tenant
    permission manage = tenant->develop + owner
    permission develop = tenant->develop + owner + developer
    permission view = tenant->view + owner + developer + viewer

    // Specific permissions
    permission create_api_key = develop
    permission create_session = develop
    permission manage_voice = develop
}

definition api_key {
    relation tenant: tenant
    relation project: project
    relation owner: user

    // Inherit from project and tenant
    permission manage = project->manage + owner
    permission use = project->develop + owner
    permission view = project->view + owner

    // Specific permissions
    permission revoke = manage
    permission rotate = manage
}

definition session {
    relation tenant: tenant
    relation project: project
    relation api_key: api_key
    relation owner: user

    // Inherit from project
    permission manage = project->manage + owner
    permission operate = project->develop + tenant->operate + owner
    permission view = project->view + owner

    // Specific permissions
    permission terminate = operate
    permission view_events = view
}

definition voice_persona {
    relation tenant: tenant
    relation project: project
    relation owner: user

    // Inherit from project
    permission manage = project->manage + owner
    permission use = project->develop + owner
    permission view = project->view + owner
}

definition theme {
    relation tenant: tenant
    relation owner: user

    // Inherit from tenant
    permission manage = tenant->administrate + owner
    permission view = tenant->view + owner
}

definition voice_model {
    // System-wide resource, no tenant relation
    relation admin: user

    permission manage = admin
    permission view = admin
}
